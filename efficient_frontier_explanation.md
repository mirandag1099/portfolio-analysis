# Efficient Frontier and Tangency Portfolio Explanation

## Overview

The efficient frontier is a fundamental concept in Modern Portfolio Theory (Markowitz). It shows the set of optimal portfolios that offer the highest expected return for a given level of risk (volatility), or the lowest risk for a given level of expected return.

## Key Components

### 1. Inputs: Expected Returns (μ) and Covariance Matrix (Σ)

**Annualized Expected Returns (μ):**
- Calculated from daily returns: `μ = mean(daily_returns) × 252`
- This gives the annualized expected return for each asset
- Example: If AAPL has a mean daily return of 0.1%, its annualized expected return is 0.1% × 252 = 25.2%

**Annualized Covariance Matrix (Σ):**
- Calculated from daily returns: `Σ = cov(daily_returns) × 252`
- This matrix captures:
  - **Variance** (diagonal): How much each asset's returns vary
  - **Covariance** (off-diagonal): How assets move together
- Example: If AAPL and MSFT have high covariance, they tend to move in the same direction

### 2. Portfolio Statistics

For any portfolio with weights **w**, we calculate:

**Portfolio Return:**
```
Return = w₁μ₁ + w₂μ₂ + ... + wₙμₙ = w^T × μ
```
This is the weighted average of expected returns.

**Portfolio Volatility (Risk):**
```
Volatility = √(w^T × Σ × w)
```
This accounts for both individual asset volatility and correlations between assets.

### 3. Efficient Frontier Curve

The efficient frontier is generated by solving a series of optimization problems:

**For each target return** between min(μ) and max(μ):
1. **Objective:** Minimize portfolio variance `w^T × Σ × w`
2. **Constraints:**
   - Portfolio weights sum to 1: `Σwᵢ = 1`
   - Long-only (no shorting): `wᵢ ≥ 0`
   - Target return: `w^T × μ = target_return`

**Result:** A curve showing the minimum volatility achievable for each level of expected return.

**Filtering:** The algorithm filters out inefficient points to create a smooth, convex curve (upper envelope) where:
- Return is non-decreasing as volatility increases
- Only the "best" portfolios for each risk level are kept

### 4. Tangency Portfolio (Max Sharpe Ratio)

The tangency portfolio is the portfolio on the efficient frontier that has the **highest Sharpe ratio**.

**Sharpe Ratio Formula:**
```
Sharpe Ratio = (Portfolio Return - Risk-free Rate) / Portfolio Volatility
```

**Why it's called "Tangency":**
- If you plot the efficient frontier and draw a line from the risk-free rate on the Y-axis, the tangency portfolio is where this line is tangent to (touches) the efficient frontier
- This line is called the **Capital Market Line (CML)**
- The tangency portfolio represents the optimal mix of risky assets when you can also invest in a risk-free asset

**Optimization:**
The tangency portfolio is found by:
1. **Objective:** Maximize Sharpe ratio = `(w^T × μ - rf) / √(w^T × Σ × w)`
   - Implemented by minimizing the **negative** Sharpe ratio
2. **Constraints:**
   - Portfolio weights sum to 1: `Σwᵢ = 1`
   - Long-only: `wᵢ ≥ 0`

**Mathematical Solution:**
Using `scipy.optimize.minimize` with the SLSQP method to find the weights that maximize the Sharpe ratio.

## Implementation Details

### Code Flow:

1. **Compute Inputs:**
   ```python
   daily_returns = prices.pct_change().dropna()
   mu = daily_returns.mean() * 252  # Annualized expected returns
   cov = daily_returns.cov() * 252   # Annualized covariance matrix
   ```

2. **Generate Efficient Frontier:**
   ```python
   # For 100 target returns between min(mu) and max(mu):
   for target_return in np.linspace(min(mu), max(mu), 100):
       # Minimize variance subject to:
       # - sum(weights) = 1
       # - weights >= 0
       # - portfolio_return = target_return
   ```

3. **Find Tangency Portfolio:**
   ```python
   # Maximize Sharpe ratio = (return - risk_free_rate) / volatility
   # Subject to: sum(weights) = 1, weights >= 0
   ```

4. **Calculate Capital Market Line:**
   ```python
   # CML connects risk-free rate to tangency portfolio
   # Formula: Return = rf + (Sharpe_ratio × Volatility)
   ```

## What the Graph Shows

1. **Efficient Frontier (Blue Curve):** The set of optimal portfolios
2. **Random Portfolios (Gray Dots):** Randomly weighted portfolios showing the feasible region
3. **Individual Assets (Colored Dots):** Each asset in the portfolio
4. **User Portfolio (Star):** Your actual portfolio allocation
5. **Benchmarks (Triangles):** SPY, QQQ, AGG, ACWI, and 60/40 mix
6. **Tangency Portfolio (Red Dot):** Optimal portfolio with highest Sharpe ratio
7. **Capital Market Line (Red Line):** Line from risk-free rate through tangency portfolio

## Interpretation

- **Portfolios on the efficient frontier** are optimal (best return for given risk)
- **Portfolios below the frontier** are inefficient (could get better return for same risk, or lower risk for same return)
- **The tangency portfolio** is the best mix of risky assets when you can also invest in risk-free assets
- **Your portfolio's position** shows how it compares to the efficient frontier

## Key Assumptions

1. **Long-only portfolios:** No short selling (weights ≥ 0)
2. **Fully invested:** All weights sum to 1 (100% allocation)
3. **Historical data:** Uses past returns to estimate future returns
4. **Normal distribution:** Assumes returns are normally distributed (simplification)
5. **Static optimization:** Assumes expected returns and covariances are constant

## Limitations

- Past performance doesn't guarantee future results
- Assumes normal distribution of returns (real markets have fat tails)
- Doesn't account for transaction costs or taxes
- Assumes you can invest at the risk-free rate (borrowing/lending)
- Static optimization (doesn't adapt to changing market conditions)

